<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<!DOCTYPE html>
<link rel="stylesheet" href="include/style.css"> 

<!-- Include relevant libraries -->
<script type="text/javascript" src="js/eclib.js"></script>
<script type="text/javascript" src="js/units.js"></script>
<script type="text/javascript" src="js/export.js"></script>
<script type="text/javascript" src="js/motors.js"></script>
<script type="text/javascript" src="js/plots.js"></script>
<script type="text/javascript" src="js/walkthrough.js"></script>

<!-- Export library requires this script tag -->
<script id="EXP_inputs_frame" ></script>

<script type="text/javascript" id="main">

	EXP_FN_BASE = 'simplemech'; // filename base for export utility
	UNIT_MAP = { // map of units
		"torque": ["N-m", "N-m"],
		"encoder_cpx": ["c/m", "c/ft"],
		"radius": ["mm","in"],
		"force": ["N", "lbf"],
		"mass": ["kg", "lbm"],
		"speed": ["m/s", "ft/s"],
		"distance": ["m", "ft"],
		"acceleration": ["m/s^2", "ft/s^2"],
		'moi': ['kg mm^2', 'lbm in^2'],
		"omega": ["RPM", "RPM"],
		"theta": ["rev", "rev"],
		"alpha": ["RPM/s", "RPM/s"],
		"angle": ["deg", "deg"],
		"pct":   ["%", "%"]
	};
	/*WALK_STEPS = [{
			poi: 'user_input_motor',
			desc: 'Input details about the motors powering your mechanism...',
			valign: 'bottom'
		},{
			poi: 'user_input_gratio',
			desc: 'Input the gear ratio (you can use the dropdown to compute it)...'
		},{
			poi: 'user_input_encoder',
			desc: 'The encoder box can be used to help figure out encoder resolution...'
		},{
			poi: 'user_input_traction',
			desc: 'Traction limiting should be used for drivetrains...'
		},{
			poi: 'user_input_electrical',
			desc: 'Simultion of voltage drop and current limiting can be done...'
		},{
			poi: 'user_input_radius',
			desc: "Plug in the effective radius of your mechanism (arm length, wheel radius, or spool radius)..."
		},{
			poi: 'user_input_mass',
			desc: 'Plug in the mass of the system being accelerated...'
		},{
			poi: 'user_input_load',
			desc: 'Plug in the load perpindicular to the radius...'
		},{
			poi: 'user_input_endcond',
			desc: 'Plug in an end condition for simulation...'
		},{
			poi: 'computed_outputs',
			desc: 'Computed/simulated values will appear here.'
		},{
			poi: 'chart',
			desc: 'Simulation results are plotted here.'
		},{
			poi: 'chart',
			desc: 'Click on the plot to probe points for values.'
		},{
			poi: 'toggle_tips_label',
			desc: 'More tips and notes are in here.'
		},{
			poi: 'toggle_varref_label',
			desc: 'Variables that can be used in the load and end condition expressions are here.'
		}];*/
</script>
<script type="text/javascript">

	/* Initialization routine run on page load */
	function init() {
		EC_onload();
		MOTOR_setupMotorSelect("motor");
		EXP_onload();
		MOTOR_selectMotor("motor");
		UNIT_change();

		// on keyup for all variables
		EC_setOnInput(function(e) {
			let key = e.keyCode ? e.keyCode : e.which;
			let input = e.target;

			if(input.id == 'toggle-gratio'){
				collapseGearRatio();
				calcRatio();
				compute();
			}
		  	
		  	if(input.id.startsWith('toggle')) return; // ignore these, just css stuff

	    	// if a key is pressed, invalidate current results
	    	setError(1);
			if (input.type == 'checkbox') {
				compute();
			}
		});
		EC_setOnKeyUp(); // default handler is OK

		calcRatio();
		compute();
		//WALK_onload();
	}

	function compute() {
		let computed_basic = false;
		try{
			
		}catch(err){
			console.log(err);
			setError(2, err);
			return;
		}
		setError(0);
		EXP_dumpPersistence();
	}
</script>

<html>

<!-- Make sure to call your init function on document load -->
<!-- You can copy the topbar template here -->
<body onload="init()">
	<div id="topbar">
		<div class="topbar-la selectable" onclick="window.location='./'">EveryCalc</div>
		<div class="topbar-la" id='topbar_version'></div>
		<div class="topbar-la" id='topbar_filename'></div>
		<div class="topbar-la" id='topbar_unit'>
			<!-- Required for unit library. You could also put this in the calculator main body -->
			<select id="unit_select" onchange="UNIT_change(); compute();">
				<option value=0 >Metric</option>
				<option value=1 selected="selected">English</option>
			</select>
		</div>
		<div class="topbar-ctr" id="topbar_title">General Mechanism Calc</div>
		<div class="topbar-ra selectable" id="topbar_status" onclick="compute();"><span></span><span class='ttt'></span></div>
		<div class="topbar-ra selectable" onclick="downloadPage();" id="download">Export HTML</div>
		<div class="topbar-ra selectable" onclick="printPage();">Print</div>
		<div class="topbar-ra selectable" onclick="WALK_enable();">Tutorial</div>
		<a id="download_frame" hidden></a>
	</div>	

	<svg id="walkthrough_overlay" onclick="WALK_nextStep()" >
		<path id="walkthrough_frame" ></path>
		<text id="walkthrough_text" ></text>
		<text id="walkthrough_skip_button" onclick="WALK_disable();">Skip Tutorial</text>
	</svg>

	<!-- From here go nuts, do whatever works for you. Use the container to keep stuff from spilling under topbar. I'll point out patterns to pay attention to. -->
	<div style="float: left; display:table-row;" class="container">
		<div class="even" id="user_input_motor" style="display:table-cell;">
			<span># Motors
			<input class='narrow' id="motor_count" oninput="MOTOR_selectMotor('motor'); compute();" value=1 /></span><br/>
			<span class="rowlabel">Motor</span>
			<select class="doublewide" id="motor_select" onchange="MOTOR_selectMotor('motor'); compute();">
			</select>
			<input class="dropdown" type="checkbox" id="toggle-motor">
			<label class="dropdown" for="toggle-motor">V</label>
			<table id='detail_motor' class="dropdown">
				<tr>
					<th class="rowlabel">Free Speed<span class="ttt">The maximum RPM of the motor</span></th>
					<td><input data-unit="omega" id="motor_max_speed" readonly value=5880 /></td>
					<td class="unit" data-unit="omega" >[RPM]</td>
				</tr><tr>
					<th class="rowlabel">Stall Torque<span class="ttt">The maximum torque of the motor, occurring at 0 RPM</span></th>
					<td><input data-unit="torque" id="motor_stall_torque" readonly value=3.36 /></td>
					<td class="unit" data-unit="torque" id="unit_motor_stall_torque"></td>
				</tr><tr>
					<th class="rowlabel">Free Current<span class="ttt">The current drawn when the motor is unloaded</span></th>
					<td><input id="motor_free_current" readonly value=1.3 /></td>
					<td class="unit">[A]</td>
				</tr><tr>
					<th class="rowlabel">Stall Current<span class="ttt">The current drawn at 0 RPM / Max Torque</span></th>
					<td><input id="motor_stall_current" readonly value=166 /></td>
					<td class="unit">[A]</td>
				</tr>
			</table>
		</div>
		<div class="output" id="computed_outputs" style="display:table-cell;">
			<table>
				<tr>
					<th class="rowlabel">Input Torque</th>
					<td><input data-unit="torque" id="input_torque" readonly /></td>
					<td class="unit" data-unit="torque"></td>
				</tr><tr>
					<th class="rowlabel">Output Torque</th>
					<td><input data-unit="torque" id="output_torque" readonly /></td>
					<td class="unit" data-unit="torque"></td>
				</tr><tr>
					<th class="rowlabel">Overall Gear Ratio</th>
					<td><input id="overall_ratio" readonly /></td>
				</tr><tr>
					<th class="rowlabel">Overall FOS</th>
					<td><input id="overall_fos" readonly /></td>
				</tr>
			</table>
		</div>
	</div>
	<div style="float: left; display:table-row;" class="container">
		
		<div id="transmission_stages" style="display:table-row"><!-- transmission stages will go inside of here --></div>
	</div>
</div>
</body>
</html>