<!DOCTYPE html>
<link rel="stylesheet" href="include/style.css">

<!-- Include relevant libraries -->
<script type="text/javascript" src="js/eclib.js"></script>
<script type="text/javascript" src="js/units.js"></script>
<script type="text/javascript" src="js/export.js"></script>
<script type="text/javascript" src="js/motors.js"></script>
<script type="text/javascript" src="js/plots.js"></script>
<script type="text/javascript" src="js/math.js"></script>
<script type="text/javascript" src="js/materials.js"></script>

<!-- Export library requires this script tag -->
<script id="EXP_inputs_frame" ></script>

<script type="text/javascript">
	EXP_FN_BASE = 'hoodpitch';
	UNIT_MAP = {
		'dim': 			['mm', 'in'],
		'mass': 		['kg', 'lbm'],
		'stiffness': 	['N/m', 'lbf/in'],
		'moi': 			['kg mm^2', 'lbm in^2'],
		'omega': 		['RPM','RPM'],
		'theta': 		['deg','deg'],
		'v':       		['m/s','ft/s'],
		'position': 	['deg', 'deg'],
		'force':     	['N', 'lbf'],
		'torque':     	['N', 'lbf'],

		'kM': ['N-m/kRPM', 'in-lbf/kRPM']
	};

	function init() {
		EC_onload();
		MOTOR_setupMotorSelect("motortype");
		EXP_onload();
		UNIT_change();
		selectMotorType();

		EC_setOnInputChange(function(e) {
		    	var key = e.keyCode ? e.keyCode : e.which;
		    	setError(1);

		    	if (key==13) {
		    		compute();
		    	}
		    });

		calcRatio();

		compute();
	}

	function computeLaunch(params_pack) {
		[d_b, m_b, moi_rat_b, k_b, w, d_w, I_w, mu_w, mu_h, omega_w_0, theta_0, theta_end] = params_pack;
		I_b = moi_rat_b*m_b*w*w/4;

		i=0;
		i_settled=NaN;
		u=theta_0; // angular positionx
		t=0;
		R=(w+d_w)/2;
		v_b=0;
		omega_b=0;
		omega_w=omega_w_0;

		res = {
			t:[t],
			u:[0],
			v_b:[v_b],
			omega_b:[omega_b],
			omega_w:[omega_w],
			N_h:[0],
			N_w:[0],
			F_h:[0],
			F_w:[0]
		}

		// [[t],[0],[v_b],[omega_b],[omega_w],[0],[0],[0],[0]];

		dt = dt0 = 1e-2/omega_w_0;

		matched_w = false; matched_h = false;
		u_regain = 0;
		retry = false;

		while(i<10000 && u>theta_end) {
			if (u < u_regain){
				dt = dt0;
				retry = false;
			}

			N_h = k_b*(d_b-w) + v_b*v_b/R*m_b/2;
			N_w = k_b*(d_b-w) - v_b*v_b/R*m_b/2;
			if (N_w < 0) N_w = 0;

			F_h = N_h * mu_h;
			F_w = N_w * mu_w;

			if (matched_w){ F_w = F_h*(w*w/4/I_b - 1/m_b) / (1/m_b + w*w/4/I_b + d_w*d_w/4/I_w); }
			if (matched_h){ F_h = F_w*(w*w/4/I_b - 1/m_b) / (w*w/4/I_b + 1/m_b); }
			if (matched_w && matched_h){ 
				F_w = 0; F_h = 0; 
				if (isNaN(i_settled)) i_settled = i;
			}


			dv       = (F_w+F_h) / m_b;
			domega_b = (F_w-F_h)*w/2 / I_b;
			domega_w = (-F_w*d_w/2) / I_w;

			v_b     += dv*dt;
			omega_b += domega_b*dt;
			omega_w += domega_w*dt;
			u       -= v_b*dt/R;
			t       += dt;

			if (!retry) {
				if (!matched_w && v_b + omega_b*w/2 > omega_w*d_w/2) {
					// really, should go back and try again with lower timestep
					retry = true;
				}
				if (!matched_h && v_b - omega_b*w/2 > 0) {
					// really, should go back and try again with lower timestep
					retry = true;
				}
				if (retry) { // fuk go back, do it slower
					u_regain = u;

					v_b     -= dv*dt;
					omega_b -= domega_b*dt;
					omega_w -= domega_w*dt;
					u       += v_b*dt/R;
					t       -= dt;

					dt = dt0/100;
					continue; // do not write to result array, do not pass go, do not collect 200 dollars
				}
			} else {
				if (v_b + omega_b*w/2 > omega_w*d_w/2) {
					matched_w = true;
					retry = false;
				}
				if (v_b - omega_b*w/2 > 0) {
					matched_h = true;
					retry = false;
				}
			}

			res.t.push(t);
			res.u.push(theta_0-u);
			res.v_b.push(v_b);
			res.omega_b.push(omega_b);
			res.omega_w.push(omega_w);
			res.N_h.push(N_h);
			res.N_w.push(N_w);
			res.F_h.push(F_h);
			res.F_w.push(F_w);

			i+=1;
		}

		stats = {
			v_b_exit: v_b,
			theta_b_exit: theta_end,
			omega_b_exit: omega_b,
			omega_w_exit: omega_w,
			i_settle: i_settled
		}

		return [res, stats];
	}

	function computeRevUp(params_pack) {
		[T_stall, omega_max, cur_free, cur_stall, I_w, omega_target, kM, omega_drop] = params_pack;

		dt = 0.01;

		i = 0;
		t = 0;
		omega = 0;
		cur_cons = 0;
		cur_cons_drop = 0;
		res = {t:[t],omega:[omega],cur:[cur_stall]};

		t_drop = 0;
		validity = 0;
		
		while(i<1000) {
			T = T_stall*(omega_max-omega)/omega_max;
			cur = cur_free + (cur_stall-cur_free)*(omega_max-omega)/omega_max;
			M = kM * omega;
			domega = (T-M)/I_w;
			omega += domega*dt;
			cur_cons += cur*dt;
			t += dt;
			i ++;

			console.log(domega, T, M, I_w, cur);

			res.t.push(t);
			res.omega.push(omega);
			res.cur.push(cur);

			if (t_drop == 0 && omega > omega_drop) {
				t_drop = t;
				cur_cons_drop = cur_cons;
				validity ++;
			}
			if (omega > omega_target) {
				validity ++;
				break;
			}
		}

		cmd_pct  = kM/(T_stall*(omega_max-omega_target)/omega_max / omega_target)
		cur_idle = cmd_pct * (cur_free + (cur_stall-cur_free)*(omega_max-omega_target)/omega_max);
		
		stats = {
			idle_current: cur_idle,
			cur_cons_live: cur_cons-cur_cons_drop,
			cur_cons_dead: cur_cons,
			t_dead: t,
			t_live: t-t_drop,
			valid: validity
		};

		return [res, stats];
	}

	let g = 9.81;

	function compute() {
		try{	

		max_low       = +Infinity;
		max_low_stat  = {};
		max_low_run   = [];
		max_low_param = []
		max_high      = -Infinity;
		max_high_stat = {};
		max_high_run  = [];
		max_high_param = [];
		params_list   = ['d_b', 'm_b', 'moi_rat_b', 'k_b', 'w', 'd_w', 'I_w', 'mu_w', 'mu_h', 'omega_w_0', 'theta_start', 'theta_end'];
		params_var_list  = [];
		params_var_count = 0;
		for (param of params_list) {
			if (getV(param+'_err')) {
				params_var_list.push(true);
				params_var_count++;
			} else {
				params_var_list.push(false);
			}
		}
		low_omega_w   = +Infinity;

		for (var i=0; i<Math.pow(2, params_var_count); i++) {
			params = [];
			pvc = 0;
			for (j=0; j<params_list.length; j++) {
				if (params_var_list[j]) {
					params.push(getV(params_list[j]) + (bit_test(i,pvc) ? 1:-1)*getV(params_list[j]+'_err'));
					pvc ++;
				} else {
					params.push(getV(params_list[j]));
				}

			}
			[run, stats] = computeLaunch(params);
			if (stats.v_b_exit < max_low)   {
				max_low      = stats.v_b_exit;
				max_low_run  = run;
				max_low_stat = stats;
				max_low_param = params;
			}
			if (stats.v_b_exit > max_high) {
				max_high      = stats.v_b_exit;
				max_high_run  = run;
				max_high_stat = stats;
				max_high_param = params;
			}
			if (stats.omega_w_exit < low_omega_w) {
				low_omega_w = stats.omega_w_exit;
			}
			//break;
		}

		

		G = getV('G');

		[rev_run, rev_stats] = computeRevUp([
			getV('motor_stall_torque_adj')*G,
			getV('motor_max_rpm_adj')/G,
			getV('motor_free_current_adj'),
			getV('motor_stall_current_adj'),
			getV('I_w') + getV('I_w_err',0),
			getV('omega_w_0'),
			getV('kM'),
			low_omega_w, '0']);

		// TODO: draw charts for real

      	//drawchart_launch(max_low_run, max_high_run, max_low_stat, max_high_stat);

      	console.log(max_high_run, max_low_run);

      	PLOT_drawLinePlot({
      		chartName: "chart_launch",
      		multiChannelBehavior: "merge2",
      		axes: {
      			x: {
					numTicks: 10,
					boxEnds: false,
					negativeHandling: 'posonly',
					margin: 15
				}, y: {
					numTicks: 7,
					boxEnds: true,
					negativeHandling: 'posonly',
					margin: 5
				}, z: {
					syncWithY: true,
					margin: 5
				}
      		},
      		datasets: {
      			u: {axis: 'x'},
      			v_b: {axis: 'y'},
      			omega_b: {axis: 'y'},
      			omega_w: {axis: 'z'}
      		},
      		queries: {
      			INDEX: {places: 0},
      			t: {places: 4},
      			u: {places: 4},
      			v_b: {places: 4},
      			omega_b: {places: 4},
      			omega_w: {places: 4},

      			N_h: {places: 3},
      			N_w: {places: 3},
      			F_h: {places: 3},
      			F_w: {places: 3}
      		}
      	}, [max_high_run, max_low_run]);

		PLOT_drawLinePlot({
      		chartName: "chart_rev",
      		axes: {
      			x: {
					numTicks: 10,
					boxEnds: false,
					negativeHandling: 'posonly',
					margin: 15
				}, y: {
					numTicks: 7,
					boxEnds: true,
					negativeHandling: 'posonly',
					margin: 5
				}, z: {
					syncWithY: true,
					margin: 5
				}
      		},
      		datasets: {
      			t: {axis: 'x'},
      			cur: {axis: 'y'},
      			omega: {axis: 'z'}
      		},
      		queries: {
      			INDEX: {places: 0},
      			t: {places: 4},
      			cur: {places: 4},
      			omega: {places: 4}
      		}
      	}, rev_run);

		setV('exit_v', (max_low_stat.v_b_exit + max_high_stat.v_b_exit)/2);
		setV('exit_theta', (max_low_stat.theta_b_exit + max_high_stat.theta_b_exit)/2);
		setV('exit_omega_b', (max_low_stat.omega_b_exit + max_high_stat.omega_b_exit)/2);
		setV('exit_omega_w', (max_low_stat.omega_w_exit + max_high_stat.omega_w_exit)/2);
		setV('exit_v_err', Math.abs(max_low_stat.v_b_exit - max_high_stat.v_b_exit)/2);
		setV('exit_theta_err', Math.abs(max_low_stat.theta_b_exit - max_high_stat.theta_b_exit)/2);
		setV('exit_omega_b_err', Math.abs(max_low_stat.omega_b_exit - max_high_stat.omega_b_exit)/2);
		setV('exit_omega_w_err', Math.abs(max_low_stat.omega_w_exit - max_high_stat.omega_w_exit)/2);
		setV('settling_dist_min', Math.min(max_low_run.u[max_low_stat.i_settle], max_high_run.u[max_high_stat.i_settle]));
		setV('settling_dist_max', Math.max(max_low_run.u[max_low_stat.i_settle], max_high_run.u[max_high_stat.i_settle]));

		setV('t_rev_live', rev_stats.t_live);
		setV('t_rev_dead', rev_stats.t_dead);
		setV('cur_cons_dead', rev_stats.cur_cons_dead);
		setV('cur_cons_live', rev_stats.cur_cons_live);
		setV('cur_idle', rev_stats.idle_current);
	} catch(err) {
		console.log(err);
		setError(2, err);
		return;
	}
	setError(0);
	}

	function calcRatio() {
		var G = 1;
		G *= getV("G1B", 1);
		G *= getV("G2B", 1);
		G *= getV("G3B", 1);
		G *= getV("G4B", 1);
		G /= getV("G1A", 1);
		G /= getV("G2A", 1);
		G /= getV("G3A", 1);
		G /= getV("G4A", 1);

		setV("G", G);
	}

	function selectMotorType() {
		e=document.getElementById("motortype");
		var props = ["max_rpm", "stall_torque", "free_current", "stall_current"];
		props.forEach(function(a) {
			
			setV("motor_"+a, MOTOR_getSpecs(e.value, a));
			adjVal = MOTOR_getSpecs(e.value, a)*getV("op_voltage")/12;
			if (a=="stall_torque")
				adjVal *= getV("motornum");
			if (a=="free_current" || a=="stall_current" )
				adjVal *= getV("motornum");
			setV("motor_"+a+"_adj",adjVal);
		});
	}
</script>

<html>

<!-- Make sure to call your init function on document load -->
<!-- You can copy the topbar template here -->
<body onload="init()">
<div id="topbar">
	<div class="topbar-la selectable" onclick="window.location='./'">EveryCalc</div>
	<div class="topbar-la" id='topbar_version'></div>
	<div class="topbar-la" id='topbar_filename'></div>
	<div class="topbar-la" id='topbar_unit'>
		<!-- Required for unit library. You could also put this in the calculator main body -->
		<select id="unit_select" onchange="UNIT_change(); compute();">
			<option value=0 >Metric</option>
			<option value=1 selected="selected">English</option>
		</select>
	</div>
	<div class="topbar-ctr" id="topbar_title">Hood and Wheel Pitcher</div>
	<div class="topbar-ra selectable" id="topbar_status"><span></span><span class='ttt'></span></div>
	<div class="topbar-ra selectable" onclick="downloadPage();" id="download">Export HTML</div>
	<div class="topbar-ra selectable" onclick="printPage();">Print</div>
	<a id="download_frame" hidden></a>
</div>

<!-- From here go nuts, do whatever works for you. Use the container to keep stuff from spilling under topbar. I'll point out patterns to pay attention to. -->
<div style="width: 100%; float: left;" class="container">
	<div style='display:table-row'>
		<div class="odd" style='display:table-cell'>
			<table>
				<tr>
					<th class="rowlabel">Ball Diameter</th>
					<td><input class='unit' data-unit='dim' id="d_b" value=7></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='dim' id="d_b_err" value=''></td>
					<td class='unit' data-unit='dim' id='unit_d_b'></td>
				</tr><tr>
					<th class='rowlabel'>Ball Mass</th>
					<td><input class='unit' data-unit='mass' id='m_b' value=0.3><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='mass' id='m_b_err' value=''></td>
					<td class='unit' data-unit='mass' id='unit_m_b'></td>
				</tr><tr>
					<th class='rowlabel'>Ball MOI Ratio<span class="ttt">Ratio of MOI to mass times radius squared.<br/>2/5 for a solid sphere, 2/3 for a hollow sphere, 1/2 for a solid cylinder, 1 for a hollow cylinder.</span></th>
					<td><input id='moi_rat_b' value='2/5'></td><td class="tiny">+/-</td>
					<td><input id='moi_rat_b_err'></td>
					<td class="unit">[-]</td>
				</tr><tr>
					<th class="rowlabel">Ball Stiffness<span class="ttt">Stiffness of the ball. This should be evaluated as a shock condition and near the amount of compression in the case of nonlinear balls (which, practically any ball will be)</span></th>
					<td><input class='unit' data-unit='stiffness' id="k_b" value=20></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='stiffness' id="k_b_err" value=''></td>
					<td class='unit' data-unit='stiffness' id='unit_k_b'></td>
				</tr><tr>
					<th class='rowlabel'>Wheel Diameter</th>
					<td><input class='unit' data-unit='dim' id='d_w' value=6></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='dim' id='d_w_err' value=''></td>
					<td class='unit' data-unit='dim' id='unit_d_w'></td>
				</tr><tr>
					<th class='rowlabel'>Wheel MOI</th>
					<td><input class='unit' data-unit='moi' id='I_w' value=4><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='moi' id="I_w_err" value=''></td>
					<td class='unit' data-unit='moi'></td>
				</tr><tr>
					<th class="rowlabel">Hood Gap</th>
					<td><input class='unit' data-unit='dim' id="w" value=5></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='dim' id="w_err" value=''></td>
					<td class='unit' data-unit='dim' id='unit_w'></td>
				</tr><tr>
					<th class="rowlabel">Hood Start<span class="ttt">Angle that the hood starts at, with respect to vertical.<br/>A larger value would mean the hood wraps around more.</span></th>
					<td><input class='unit' data-unit='theta' id="theta_start" value=120></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='theta' id="theta_start_err"></td>
					<td class='unit' data-unit='theta' id='unit_theta_start'></td>
				</tr><tr>
					<th class='rowlabel'>Hood End<span class="ttt">Angle that the hood ends at, with respect to vertical.<br/>This would be the same as the release/departure angle with respect to the horizontal.<br/>A larger value would mean that the hood wraps around less, and creates a more vertical shot.</span></th>
					<td><input class='unit' data-unit='theta' id='theta_end' value=15></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='theta' id='theta_end_err' value=''></td>
					<td class='unit' data-unit='theta' id='unit_theta_end'></td>
				</tr><tr>
					<th class="rowlabel">COF Wheel</th>
					<td><input id="mu_w" value=1.0></td><td class="tiny">+/-</td>
					<td><input id="mu_w_err" value=''></td>
					<td class="unit">[-]</td>
				</tr><tr>
					<th class='rowlabel'>COF Hood</th>
					<td><input id='mu_h' value=0.5></td><td class="tiny">+/-</td>
					<td><input id='mu_h_err' value=''></td>
					<td class='unit'>[-]</td>
				</tr><tr>
					<th class='rowlabel'>Flywheel Target Velocity</th>
					<td><input class='unit' data-unit='omega' id='omega_w_0' value=3000></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='omega' id='omega_w_0_err' value=''></td>
					<td class='unit' data-unit='omega' id='unit_omega_w_0'>[-]</td>
				</tr>
			</table>
		</div>
		<div class="even" style='display:table-cell'>
			<div>
				<span class="rowlabel">Motor</span>
				<select class="doublewide" id="motortype" oninput="selectMotorType(); compute();"></select>
				<!--<button type="button" onclick="collapse('motor')" id='toggle_detail_motor'>&#9660;</button>-->
			</div>
			<table id='detail_motor'>
				<tr>
					<th class="rowlabel"># Motors<span class="ttt">How many motors do you have in total for this mechanism (assuming they're identical, and geared together)</span> </th>
					<td><input class='' id="motornum" oninput="selectMotorType(); compute();" value=1 /></td>
				</tr><tr>
					<th class="rowlabel">Voltage<span class="ttt">What voltage are the motors ran at? (assuming that the nominal motor performance is at 12V)</span></th>
					<td><input class='' id="op_voltage" oninput="selectMotorType(); compute();" value=12 /></td>
					<td class="unit">[V]</td>
				</tr><tr>
					<th class="rowlabel">Resistance<span class="ttt">Resistance value.<br/>You could find this empirically using this tool by guessing values until the idle current matches your shooter.</span></th>
					<td><input class='unit' data-unit='kM' id="kM" oninput="selectMotorType(); compute();" value=0 /></td>
					<td class='unit' data-unit='kM' id="unit_kM"></td>
				</tr>
				<tr>
					<th></th>
					<th class="collabel">Raw Motor</th>
					<th class="collabel">Adjusted</th>
					<th></th>
				</tr>
				<tr>
					<th class="rowlabel">Free Speed<span class="ttt">The maximum RPM of the motor</span></th>
					<td><input class='unit' data-unit='omega' id="motor_max_rpm" readonly /></td>
					<td><input class='unit' data-unit='omega' id="motor_max_rpm_adj" readonly /></td>
					<td class='unit' data-unit='omega' >[RPM]</td>
				</tr><tr>
					<th class="rowlabel">Stall Torque<span class="ttt">The maximum torque of the motor, occurring at 0 RPM</span></th>
					<td><input class='unit' data-unit='torque' id="motor_stall_torque" readonly /></td>
					<td><input class='unit' data-unit='torque' id="motor_stall_torque_adj" readonly /></td>
					<td class='unit' data-unit='torque' >[N-m]</td>
				</tr><tr>
					<th class="rowlabel">Free Current<span class="ttt">The current drawn when the motor is unloaded</span></th>
					<td><input id="motor_free_current" readonly /></td>
					<td><input id="motor_free_current_adj" readonly /></td>
					<td class="unit">[A]</td>
				</tr><tr>
					<th class="rowlabel">Stall Current<span class="ttt">The current drawn at 0 RPM / Max Torque</span></th>
					<td><input id="motor_stall_current" readonly /></td>
					<td><input id="motor_stall_current_adj" readonly /></td>
					<td class="unit">[A]</td>
				</tr>
			</table>
			<div class="odd">
				<span class='rowlabel'>Gear Ratio<span class="ttt">The overall gear ratio. Larger than 1 is a reduction, smaller is a RPM increase. Empty cells are assumed to be 1. You can either blank out all the cells, and plug in a number in the top right one, or build a ratio by typing in the number of teeth on each gear (or belts/sprockets) starting from the motor.</span></span>
				<input id="G" readonly/>
				<!--<button type="button" onclick="collapse('gratio')" id='toggle_detail_gratio'>&#9660;</button>-->
			</div>
			<table id='detail_gratio'>
				<tr>
					<td><input id="G1A" oninput="calcRatio()" /></td>
					<td class="tiny">:</td>
					<td><input id="G1B" oninput="calcRatio()" value=1 /></td>
				</tr><tr>
					<td><input id="G2A" oninput="calcRatio()" /></td>
					<td class="tiny">:</td>
					<td><input id="G2B" oninput="calcRatio()" /></td>
				</tr><tr>
					<td><input id="G3A" oninput="calcRatio()" /></td>
					<td class="tiny">:</td>
					<td><input id="G3B" oninput="calcRatio()" /></td>
				</tr><tr>
					<td><input id="G4A" oninput="calcRatio()" /></td>
					<td class="tiny">:</td>
					<td><input id="G4B" oninput="calcRatio()" /></td>
				</tr>
			</table>
		</div>
		<div class="output" style='display:table-cell'>
			<center><button type="button" onclick="compute()" id="compute_btn">Compute!</button></center>
			<table>
				<tr>
					<th class='rowlabel'>Exit Velocity</th>
					<td><input class='unit' data-unit='v' id='exit_v' readOnly></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='v' id='exit_v_err' readOnly></td>
					<td class='unit' data-unit='v' id='unit_exit_v'></td>
				</tr><tr>
					<th class='rowlabel'>Exit Angle</th>
					<td><input class='unit' data-unit='theta' id='exit_theta' readOnly></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='theta' id='exit_theta_err' readOnly></td>
					<td class='unit' id='unit_exit_theta'></td>
				</tr><tr>
					<th class='rowlabel'>Exit Ball Spin</th>
					<td><input class='unit' data-unit='omega' id='exit_omega_b' readOnly></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='omega' id='exit_omega_b_err' readOnly></td>
					<td class='unit' data-unit='omega' id='unit_exit_omega_b'></td>
				</tr><tr>
					<th class="rowlabel">Exit Flywheel RPM</th>
					<td><input class='unit' data-unit='omega' id="exit_omega_w" readOnly></td><td class="tiny">+/-</td>
					<td><input class='unit' data-unit='omega' id="exit_omega_w_err" readOnly></td>
					<td class='unit' data-unit='omega' id='unit_exit_omega_w'></td>
				</tr><tr>
					<th class="rowlabel">Settling Distance</th>
					<td><input class='unit' data-unit='position' id="settling_dist_min" readOnly></td>
					<td class="tiny">to</td>
					<td><input class='unit' data-unit='position' id="settling_dist_max" readOnly></td>
					<td class='unit' data-unit='position'></td>
				</tr><tr>
					<th class="rowlabel" colspan=3>Time to Recover</th>
					<td><input id="t_rev_live" readOnly></td>
					<td class="unit">[s]</td>
				</tr><tr>
					<th class="rowlabel" colspan=3>Current to Recover</th>
					<td><input id="cur_cons_live" readOnly></td>
					<td class="unit">[A-s]</td>
				</tr><tr>
					<th class="rowlabel" colspan=3>Time to Revved</th>
					<td><input id="t_rev_dead" readOnly></td>
					<td class="unit">[s]</td>
				</tr><tr>
					<th class="rowlabel" colspan=3>Current to Rev</th>
					<td><input id="cur_cons_dead" readOnly></td>
					<td class="unit">[A-s]</td>
				</tr><tr>
					<th class="rowlabel" colspan=3>Idle Current</th>
					<td><input id="cur_idle" readOnly></td>
					<td class="unit">[A]</td>
				</tr>
			</table>
		</div>
		<div class="even" style='display:table-cell'>
			<table id="table_protips">
				<tr>
					<th class='rowlabel' colspan=2>Pro-Tips</th>
					<td>
						<button type="button" onclick="collapse('protips'); shape_select(true)" id='toggle_detail_protips'>&#9650;</button>
					</td>
				</tr><tr>
					<td colspan=3>
						Yellow: Not computed. Press enter on a field or press the compute button.<br/>
						Green: Computed, no issues.<br/>
						Red: An error has occurred with the results.
					</td>
				</tr><tr>
					<td colspan=3>
						The plot displays the run with the highest exit velocity, and lowest exit velocity.
					</td>
				</tr><tr>
					<td colspan=3>
						Click on the plot to probe particular points for values.
					</td>
				</tr><tr>
					<td colspan=3>
						The settling distance (where the values of everything evens out and stops changing)<br/>is marked on the plot at the black vertical lines.
					</td>
				</tr>
			</table>
		</div>
	</div>
</div>

<div style="margin-left: 0px; display:table-cell;" class="container" id="charts">
	<div>
		<div style="margin-left: 0px; display:table-cell;">
		<center>Launch Simulation</center>

	<svg version="1.2" class="plot" id='chart_launch' aria-labelledby="title" role="img" style="height:550px; width:800px;">
		<rect class="plot-background" id="chart_launch_background" x=110 y=20 width=615 height=430 />
		<g>
		  <line id="chart_launch_x_axis" class="plot-axis" x1=110 x2=725 y1=450 y2=450></line>
		  <line id="chart_launch_y_axis" class="plot-axis" x1=110 x2=110 y1=20  y2=450></line>
		  <line id="chart_launch_z_axis" class="plot-axis" x1=725 x2=725 y1=20  y2=450></line>
		</g>

		<g class="plot-grid" id="chart_launch_x_grid"></g>
		<g class="plot-grid" id="chart_launch_y_grid"></g>
		<g class="plot-grid" id="chart_launch_z_grid"></g>

		<g class="plot-labels">
		  <text x="425" y=485 class="plot-titlelabel unit" data-unit="position" id="chart_launch_u_label">Position []</text>

		  <text x=-320 y=15 class="plot-titlelabel unit" data-unit="v" transform="rotate(270)" id="chart_launch_v_b_label" fill="#0074d9">Ball Velocity []</text>
		  <text x=-160 y=15 class="plot-titlelabel unit" data-unit="omega" transform="rotate(270)" id="chart_launch_omega_b_label" fill="#d91200">Ball Spin []</text>
		  <text x=-240 y=15 class="plot-titlelabel" transform="rotate(270)" id="chart_launch_y1_divider" fill="#111">/</text>

		  <text x=-240 y=800 class="plot-titlelabel unit" data-unit="omega" transform="rotate(270)" id="chart_launch_omega_w_label" fill="#c48900">Flywheel Speed []</text>
		</g>

		<g class="plot-axlabels" id='chart_launch_x_axlabels'></g>
		<g class="plot-axlabels" id='chart_launch_z_axlabels'></g>
		<g class="plot-axlabels" id='chart_launch_y_axlabels'></g>

		<g>
			<line class="plot-querybar" id="chart_launch_querybar" x1=100 x2=100 y1=15 y2=455 opacity=0></line>
			<line class="plot-markerbar" id="chart_launch_stable_line_1" x1=110 x2=110 y1=15 y2=455 opacity=0></line>
			<line class="plot-markerbar" id="chart_launch_stable_line_2" x1=110 x2=110 y1=15 y2=455 opacity=0></line>
		</g>
		<polyline
			id='chart_launch_v_b_line'
			stroke='#0074d9'
			fill='#0074d9'
			fill-opacity=0.3
			stroke-width=2
			points="
			"/>
		<polyline
			id='chart_launch_omega_b_line'
			stroke='#d91200'
			fill='#d91200'
			fill-opacity=0.3
			stroke-width=2
			points="
			"/>
		<polyline
			id='chart_launch_omega_w_line'
			stroke='#c48900'
			fill='#c48900'
			stroke-width=2
			fill-opacity=0.3
			points="
			"/>
	</svg>

	
	<div class="output-plot" id="chart_launch_querytable" style="display:none;">
		<table>
			<tr>
				<th class="rowlabel">Queried Position<span class="ttt">Query a position on the graph by clicking (and optionally dragging) a point. Position represented by a vertical bar.</span></th>
				<td><input class='unit' data-unit='position' id="chart_launch_u_1" onkeyup="focus_handler(getV('query_u'), true);" /><input class='unit' data-unit='position' id="chart_launch_u_2" hidden /></td>
				<td class='unit' data-unit='position'>[s]</td>
			</tr><tr>
				<th class="rowlabel">Time</th>
				<td><input id="chart_launch_t_1" readonly /></td>
				<td><input id="chart_launch_t_2" readonly /></td>
				<td class="unit">[s]</td>
			</tr><tr>
				<th class="rowlabel">Timestep</th>
				<td><input id="chart_launch_INDEX_1" readonly /></td>
				<td><input id="chart_launch_INDEX_2" readonly /></td>
				<td class="unit"></td>
			</tr><tr>
				<th class="rowlabel">Ball Velocity</th>
				<td><input class='unit' data-unit='v' id="chart_launch_v_b_1" readonly /></td>
				<td><input class='unit' data-unit='v' id="chart_launch_v_b_2" readonly /></td>
				<td class='unit' data-unit='v'></td>
			</tr><tr>
				<th class="rowlabel">Ball Spin</th>
				<td><input class='unit' data-unit='omega' id="chart_launch_omega_b_1" readonly /></td>
				<td><input class='unit' data-unit='omega' id="chart_launch_omega_b_2" readonly /></td>
				<td class='unit' data-unit='omega'>[A]</td>
			</tr><tr>
				<th class="rowlabel">Flywheel Speed</th>
				<td><input class='unit' data-unit='omega' id="chart_launch_omega_w_1" readonly /></td>
				<td><input class='unit' data-unit='omega' id="chart_launch_omega_w_2" readonly /></td>
				<td class='unit' data-unit='omega'></td>
			</tr><tr>
				<th class="rowlabel">Hood Normal</th>
				<td><input class='unit' data-unit='force' id="chart_launch_N_h_1" readonly /></td>
				<td><input class='unit' data-unit='force' id="chart_launch_N_h_2" readonly /></td>
				<td class='unit' data-unit='force'></td>
			</tr><tr>
				<th class="rowlabel">Hood Force</th>
				<td><input class='unit' data-unit='force' id="chart_launch_F_h_1" readonly /></td>
				<td><input class='unit' data-unit='force' id="chart_launch_F_h_2" readonly /></td>
				<td class='unit' data-unit='force'></td>
			</tr><tr>
				<th class="rowlabel">Flywheel Normal</th>
				<td><input class='unit' data-unit='force' id="chart_launch_N_w_1" readonly /></td>
				<td><input class='unit' data-unit='force' id="chart_launch_N_w_2" readonly /></td>
				<td class='unit' data-unit='force'></td>
			</tr><tr>
				<th class="rowlabel">Flywheel Force</th>
				<td><input class='unit' data-unit='force' id="chart_launch_F_w_1" readonly /></td>
				<td><input class='unit' data-unit='force' id="chart_launch_F_w_2" readonly /></td>
				<td class='unit' data-unit='force'></td>
			</tr>
		</table>
	</div>
	</div><div style="margin-left: 0px; display:table-cell;" >
		<center>Spin-Up Simulation</center>
		<svg version="1.2" class="plot" id='chart_rev' aria-labelledby="title" role="img" style="height:550px; width:800px;">
			<rect class="plot-background" id="chart_rev_background" x=90 y=20 width=615 height=430 />
			<g>
			  <line id="chart_rev_x_axis" class="plot-axis" x1=90  x2=705 y1=450 y2=450></line>
			  <line id="chart_rev_y_axis" class="plot-axis" x1=90  x2=90  y1=20  y2=450></line>
			  <line id="chart_rev_z_axis" class="plot-axis" x1=705 x2=705 y1=20  y2=450></line>
			</g>

			<g class="plot-grid" id="chart_rev_x_grid"></g>
			<g class="plot-grid" id="chart_rev_y_grid"></g>
			<g class="plot-grid" id="chart_rev_z_grid"></g>

			<g class="plot-labels">
			  <text x=405 y=485 class="plot-titlelabel" id="chart_rev_t_label">Time [s]</text>
			  <text x=-240 y=15 class="plot-titlelabel unit" transform="rotate(270)" id="chart_rev_cur_label" fill="#d91200">Current Draw [A]</text>
			  <text x=-240 y=800 class="plot-titlelabel unit" transform="rotate(270)" id="chart_rev_omega_label" fill="#0074d9">Flywheel Speed [RPM]</text>
			</g>

			<g class="plot-axlabels" id='chart_rev_x_axlabels'></g>
			<g class="plot-axlabels" id='chart_rev_z_axlabels'></g>
			<g class="plot-axlabels" id='chart_rev_y_axlabels'></g>

			<g>
				<line class="plot-querybar"  id="chart_rev_querybar" x1=100 x2=100 y1=15 y2=555 opacity=0></line>
				<line class="plot-markerbar" id="chart_rev_stable_line_2" x1=100 x2=100 y1=15 y2=455 opacity=0></line>
				<line class="plot-markerbar" id="chart_rev_stable_line_1" x1=100 x2=100 y1=15 y2=455 opacity=0></line>
			</g>

			<polyline
				id='chart_rev_omega_line'
				stroke='#0074d9'
				fill=none
				stroke-width=2
				points="
				"/>
			<polyline
				id='chart_rev_cur_line'
				stroke='#d91200'
				fill=none
				stroke-width=2
				points="
				"/>
		</svg>
		<div class="output-plot" id="chart_rev_querytable" style="display:none;">
			<table>
				<tr>
					<th class="rowlabel">Queried Time<span class="ttt">Query a time on the graph by clicking (and optionally dragging) a point. Position represented by a vertical bar.</span></th>
					<td><input id="chart_rev_t" /></td>
					<td class="unit">[s]</td>
				</tr><tr>
					<th class="rowlabel">Timestep</th>
					<td><input id="chart_rev_INDEX" readonly /></td>
					<td class="unit"></td>
				</tr><tr>
					<th class="rowlabel">Flywheel Speed</th>
					<td><input class='unit' data-unit='omega' id="chart_rev_omega" readonly /></td>
					<td class='unit' data-unit='omega'>[RPM]</td>
				</tr><tr>
					<th class="rowlabel">Current</th>
					<td><input id="chart_rev_cur" readonly /></td>
					<td class="unit">[A]</td>
				</tr>
			</table>
		</div>
	</div>
	</div>
</div>
</body>
</html>