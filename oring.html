<!DOCTYPE html>
<link rel="stylesheet" href="include/style.css"> 
<script type="text/javascript" src="include/specs.js"></script>
<script type="text/javascript">
	unit_sys = 0;
	inputs_unit_map = {
		'd1': ['mm', 'in'],
		'd2': ['mm', 'in'],
		'd3': ['mm', 'in'],
		'd4': ['mm', 'in'],
		'd5': ['mm', 'in'],
		'rw': ['mm', 'in'],
		'rid':['mm', 'in'],

		'd1_err': ['mm', 'in'],
		'd2_err': ['mm', 'in'],
		'd3_err': ['mm', 'in'],
		'd4_err': ['mm', 'in'],
		'd5_err': ['mm', 'in'],
		'rw_err': ['mm', 'in'],
		'rid_err':['mm', 'in']
	}

	function switch_units() {
		if(document.getElementById('unit_metric').checked)
			unit_sys = 0;
		else 
			unit_sys = 1;

		unit_labels = document.getElementsByClassName('unit');
		//console.log(unit_labels);
		for (unit in unit_labels) {
			if (unit_labels[unit].id && inputs_unit_map[unit_labels[unit].id.substring(5)] ){
				varname = unit_labels[unit].id.substring(5);
				document.getElementById('unit_'+varname).innerHTML = '['+inputs_unit_map[varname][unit_sys]+']';
			}
		}
		select_dash_size();
		compute();
	}

	function gidv(id, default_value) {

		v =  eval(document.getElementById(id).value);
		console.log(id, v);
		if (typeof default_value!=='undefined' && typeof v === 'undefined') v=default_value;
		if (typeof inputs_unit_map[id] !== 'undefined')
			v = convert(v, inputs_unit_map[id][unit_sys]);
		return v;
	}

	function gids(id, value, places) {
		if (typeof places === 'undefined')
			places = 3;
		if (typeof inputs_unit_map[id] !== 'undefined')
			value = convert_to(value, inputs_unit_map[id][unit_sys]);
		document.getElementById(id).value = value.toFixed(places);
	}

	function thload() {
		var inputs, index;

		switch_units();

		inputs = document.getElementsByTagName('input');
		for (index = 0; index < inputs.length; ++index) {
		    inputs[index].onkeyup = function(e) {
		    	var key = e.keyCode ? e.keyCode : e.which;

		    	if (key==13) {
		    		compute(true);
		    	} else {
		    		compute(false);
		    	}
		    }
		}
	}

	function select_dash_size() {
		size = document.getElementById('dashsize').value.toString();
		dims = dash_sizes[size]; // in width, in ID, mm width, mm ID
		console.log(size, dash_sizes);
		if (unit_sys == 0) { // mm
			document.getElementById('rw').value  = dims[2];
			document.getElementById('rid').value = dims[3];

		} else { // inches
			document.getElementById('rw').value  = dims[0];
			document.getElementById('rid').value = dims[1];
		}

	}

	function illustration_hover (x) {
		console.log('hover ', x);
		for (el of document.getElementsByClassName('hovered')) {
			el.classList.remove('hovered');
		}
		inp = document.getElementById('d'+x);
		inp.classList.add('hovered');
		inp.focus();
	}
</script>

<html>
<body onload="thload()">
<div style="float: left;" class="container">
	<h3>Thad's O-Ring Calculator</h3>
	<center>
		<a href="./">Back To Index</a>
	</center>

<div style='display:table-row'>
	<div class="odd" style='display:table-cell'>
		<table>
			<tr>
				<td colspan=5 style="text-align:center;">
				  <input type="radio" id="unit_english" name="unit" value="english" onclick="switch_units()">
				  <label for="english">English</label>
				  <input type="radio" id="unit_metric" name="unit" value="metric" onclick="switch_units()" checked>
				  <label for="metric">Metric</label>
				</td>
			</tr>
			<tr>
				<th class="rowlabel">Type</th>
				<td colspan=4>
					<select id="type" onselect="select_type()" class="doublewide">
						<option value="rad_m">Radial, Male Groove</option>
						<option value="rad_f">Radial, Female Groove</option>
						<option value="rad_h">Radial, No Groove</option>
						<option value="face">Face</option>
					</select>
				</td>
			</tr>
			<tr>
				<th class="rowlabel"></th>
				<td><input id="d1"></td>
				<td class="tiny">&#177;</td>
				<td><input id="d1_err"></td>
				<td class="unit" id="unit_d1"></td>
			</tr><tr>
				<th class="rowlabel"></th>
				<td><input id="d2"></td>
				<td class="tiny">&#177;</td>
				<td><input id="d2_err"></td>
				<td class="unit" id="unit_d2"></td>
			</tr><tr>
				<th class="rowlabel"></th>
				<td><input id="d3"></td>
				<td class="tiny">&#177;</td>
				<td><input id="d3_err"></td>
				<td class="unit" id="unit_d3"></td>
			</tr><tr>
				<th class="rowlabel"></th>
				<td><input id="d4"></td>
				<td class="tiny">&#177;</td>
				<td><input id="d4_err"></td>
				<td class="unit" id="unit_d4"></td>
			</tr><tr>
				<th class="rowlabel"></th>
				<td><input id="d5"></td>
				<td class="tiny">&#177;</td>
				<td><input id="d5_err"></td>
				<td class="unit" id="unit_d5"></td>
			</tr>

			<tr>
				<th class="rowlabel">Dash Size</th>
				<td colspan=3>
					- <input id="dashsize" onkeyup="select_dash_size()">
				</td>
			</tr>
			<tr>
				<th class="rowlabel">Ring Width</th>
				<td><input id="rw" onkeyup="invalidate_dash_size()"></td>
				<td class="tiny">&#177;</td>
				<td><input id="rw_err"></td>
				<td class="unit" id="unit_rw"></td>
			</tr><tr>
				<th class="rowlabel">Ring ID</th>
				<td><input id="rid" onkeyup="invalidate_dash_size()"></td>
				<td class="tiny">&#177;</td>
				<td><input id="rid_err"></td>
				<td class="unit" id="unit_rid"></td>
			</tr>
		</table>
	</div>
	<div class="output-graph" style='margin-left: 0px; display:table-cell;'>
		<style>
			.illustration {
				width: 300px;
				height: 300px;
			}

			.line {
				stroke: #111;
				stroke-width: 2px;
				fill: none;
			}
			.arrow {
				stroke: #111;
				stroke-width: 2px;
				fill: none;
				 marker-end: url(#arrowhead);
			}
			.linefill {
				stroke: #111;
				stroke-width: 2px;
				fill: #ccc;
			}
			.linefill_2 {
				stroke: #111;
				stroke-width: 2px;
				fill: #aaa;				
			}
			.linefill_3 {
				stroke: #111;
				stroke-width: 2px;
				fill: #333;				
			}
			.field {
				stroke: #000;
				stroke-width: 1px;
				fill: #fff;		
			}
			.text {
				text-anchor: middle;
				font-size: 12px;
				transform: translateY(5px);
			}
		</style><br style="font-size: 1px"/>
		<svg version="1.2" id="graphic_rad_h" class='illustration' role="img">
			  <defs>
			    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
			    refX="0" refY="2" orient="auto">
			      <polygon points="0 0, 9 2, 0 4" />
			    </marker>
			  </defs>

			<polyline fill='none' stroke='none' points="0,0 0,300 300,300 300,0 0,0"/>
			<polyline id='rad_h_piston' class='linefill'   points="100,280 100,150 120,150 120,30 180,30 180,150 200,150 200,280"/>
			<polyline id='rad_h_left'   class='linefill_2' points="10,60  110,60 110,110 90,110  90,240  10,240"  />
			<polyline id='rad_h_right'  class='linefill_2' points="290,60 190,60 190,110 210,110 210,240 290,240" />
			<circle class="linefill_3" cx=105 cy=130 r=15 />
			<circle class="linefill_3" cx=195 cy=130 r=15 />

			<line x1=90  x2=100 y1=40 y2=40 class='arrow'/>
			<line x1=230 x2=200 y1=40 y2=40 class='arrow'/>
			<g onmouseover="illustration_hover(1)" onmouseout="illustration_hover()" onkeyup=>
				<rect class="field" x=220 y=30 width=20 height=20 />
				<text class="text"  x=230 y=40 >A</text>
			</g>

			<line x1=70  x2=80  y1=260 y2=260 class='arrow'/>
			<line x1=240 x2=220 y1=260 y2=260 class='arrow'/>
			<g onmouseover="illustration_hover(2)" onmouseout="illustration_hover()">
				<rect class="field" x=230 y=250 width=20 height=20 />
				<text class="text"  x=240 y=260 >B</text>
			</g>

			<line x1=60  x2=70  y1=190 y2=190 class='arrow'/>
			<line x1=250 x2=230 y1=190 y2=190 class='arrow'/>
			<g onmouseover="illustration_hover(3)" onmouseout="illustration_hover()">
				<rect class="field" x=250 y=180 width=20 height=20 />
				<text class="text"  x=260 y=190 >C</text>
			</g>

			<line x1=80  x2=90  y1=80 y2=80 class='arrow'/>
			<line x1=250 x2=210 y1=80 y2=80 class='arrow'/>
			<g onmouseover="illustration_hover(4)" onmouseout="illustration_hover()">
				<rect class="field" x=250 y=70  width=20 height=20 />
				<text class="text"  x=260 y=80 >D</text>
			</g>

			<line x1=50 x2=50 y1=80  y2=90  class='arrow'/>
			<line x1=50 x2=50 y1=180 y2=170 class='arrow'/>
			<line x1=40 x2=85 y1=150 y2=150 class='line'/>
			<line x1=40 x2=85 y1=110 y2=110 class='line'/>
			<g onmouseover="illustration_hover(5)" onmouseout="illustration_hover()">
				<rect class="field" x=40 y=120  width=20 height=20 />
				<text class="text"  x=50 y=130 >E</text>
			</g>
		</svg>
	</div>
	<div class="output" style="margin-left: 0px; display:table-cell;">
		<table>
			<tr>
				<th class="rowlabel">Application</th>
				<td colspan=4>
					<select id="type" onselect="select_application()" class="doublewide">
						<option value="s">Static</option>
						<option value="d">Dynamic</option>
					</select>
				</td>
			</tr>
			<tr>
				<th></th>
				<td class="collabel" colspan=2>Actual</td>
				<td class="collabel" colspan=2>Target</td>
			</tr><tr>
				<th></th>
				<td class="collabel">Min</td>
				<td class="collabel">Max</td>
				<td class="collabel">Min</td>
				<td class="collabel">Max</td>
			</tr>

			<tr>
				<th class="rowlabel">Compression</th>
				<td><input id="com_min"></td>
				<td><input id="com_max"></td>
				<td><input id="com_opt_min" readonly class="narrow"></td>
				<td><input id="com_opt_max" readonly class="narrow"></td>
				<td class="unit">[%]</td>
			</tr><tr>
				<th class="rowlabel">Stretch</th>
				<td><input id="str_min"></td>
				<td><input id="str_max"></td>
				<td><input id="str_opt_min" readonly class="narrow"></td>
				<td><input id="str_opt_max" readonly class="narrow"></td>
				<td class="unit">[%]</td>
			</tr><tr>
				<th class="rowlabel">Squeeze</th>
				<td><input id="sqe_min"></td>
				<td><input id="sqe_max"></td>
				<td><input id="sqe_opt_min" readonly class="narrow"></td>
				<td><input id="sqe_opt_max" readonly class="narrow"></td>
				<td class="unit"></td>
			</tr><tr>
				<th class="rowlabel">Volume Fill</th>
				<td><input id="vol_min"></td>
				<td><input id="vol_max"></td>
				<td><input id="vol_opt_min" readonly class="narrow"></td>
				<td><input id="vol_opt_max" readonly class="narrow"></td>
				<td class="unit">[%]</td>
			</tr>
		</table>
	</div>
</div>
</div>
</body>
</html>