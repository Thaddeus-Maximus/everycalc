<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<!DOCTYPE html>
<link rel="stylesheet" href="include/style.css"> 

<!-- Include relevant libraries -->
<script type="text/javascript" src="js/eclib.js"></script>
<script type="text/javascript" src="js/units.js"></script>
<script type="text/javascript" src="js/export.js"></script>
<script type="text/javascript" src="js/isofits.js"></script>
<script type="text/javascript" src="js/walkthrough.js"></script>

<!-- Export library requires this script tag -->
<script id="EXP_inputs_frame" ></script>

<script type="text/javascript">
	EXP_FN_BASE = 'fit_tol';
	UNIT_MAP = {
		'dimension': ['mm', 'in'] // ezpz
	};
	WALK_STEPS = [{
			poi: 'type',
			desc: 'Select the gland type...',
			valign: 'bottom'
		},{
			poi: 'user_inputs',
			desc: 'Plug in gland dimensions...',
			valign: 'bottom'
		},{
			poi: 'dashsize',
			desc: 'Standard o-ring sizes can be input here.'
		},{
			poi: 'computed_outputs',
			desc: 'Min and max values are calculated here.',
			valign: 'bottom',
			halign: 'right'
		}];
</script>
<script type="text/javascript">

	function init() {
		EC_onload();
		EXP_onload();
		UNIT_change();

		populateIntents();
		populateClasses('class_hole_0');
		populateClasses('class_shaft_0');

		// not an expensive calculator, just fire on all changes
		EC_setOnInput(
			function(e) {
		    	var key = e.keyCode ? e.keyCode : e.which;
		    	if(key!=13) setError(1);

		    	compute();
		    });
		EC_setOnKeyUp(); // default handler ok

		//WALK_onload();
	}

	function compute() {
		try{
		}catch(err){
			console.log(err);
			setError(2, err);
			return;
		}
		setError(0);
		EXP_dumpPersistence();
	}

	function populateIntents() {
		let select = document.getElementById('intent_0');
		let opt = document.createElement('option');
			opt.innerHTML = '';
			opt.value = '';
			select.appendChild(opt);

		for (intent in ISOFIT_INTENTS) {
			opt = document.createElement('option');
			opt.innerHTML = intent;
			opt.value = intent;
			select.appendChild(opt);
		}
	}

	function populateClasses(x) {
		let select = document.getElementById(x);
		for (intent of ISOFIT_CLASSES) {
			opt = document.createElement('option');
			opt.innerHTML = intent;
			opt.value = intent;
			select.appendChild(opt);
		}
	}

	function selectIntent() {
		let intentSelect = document.getElementById('intent_0');
		let basisSelect = document.getElementById('basis_0');
		console.log(intentSelect.value, basisSelect.value);

		if (intentSelect.value != '' && basisSelect.value != '') {
			let holeSelect  = document.getElementById('class_hole_0');
			let shaftSelect = document.getElementById('class_shaft_0');

			selectItemByValue(holeSelect,  ISOFIT_INTENTS[intentSelect.value][basisSelect.value][0]);
			selectItemByValue(shaftSelect, ISOFIT_INTENTS[intentSelect.value][basisSelect.value][1]);
			console.log('selected', ISOFIT_INTENTS[intentSelect.value]);
		} else {
			basisSelect.value = '';
		}
	}

	function selectBasis() {
		let intentSelect = document.getElementById('intent_0');
		let basisSelect = document.getElementById('basis_0');
		console.log(intentSelect.value, basisSelect.value);

		if (intentSelect.value != '' && basisSelec.value != '') {
			let holeSelect  = document.getElementById('class_hole_0');
			let shaftSelect = document.getElementById('class_shaft_0');

			selectItemByValue(holeSelect,  ISOFIT_INTENTS[intentSelect.value][basisSelect.value][0]);
			selectItemByValue(shaftSelect, ISOFIT_INTENTS[intentSelect.value][basisSelect.value][1]);
			console.log('selected', ISOFIT_INTENTS[intentSelect.value]);
		} else {
			basisSelect.value = '';
		}
	}
</script>

<html>

<!-- Make sure to call your init function on document load -->
<!-- You can copy the topbar template here -->
<body onload="init()">
	<div id="topbar">
		<div class="topbar-la selectable" onclick="window.location='./'">EveryCalc</div>
		<div class="topbar-la" id='topbar_version'></div>
		<div class="topbar-la" id='topbar_filename'></div>
		<div class="topbar-la" id='topbar_unit'>
			<!-- Required for unit library. You could also put this in the calculator main body -->
			<select id="unit_select" onchange="UNIT_change(); compute();">
				<option value=0 >Millimeters</option>
				<option value=1 selected="selected">Inches</option>
			</select>
		</div>
		<div class="topbar-ctr" id="topbar_title">Fit Clearance/Interference Calculator</div>
		<div class="topbar-ra selectable" id="topbar_status"><span></span><span class='ttt'></span></div>
		<div class="topbar-ra selectable" onclick="downloadPage();" id="download">Export HTML</div>
		<div class="topbar-ra selectable" onclick="printPage();">Print</div>
		<div class="topbar-ra selectable" onclick="WALK_enable();">Tutorial</div>
		<a id="download_frame" hidden></a>
	</div>	

	<svg id="walkthrough_overlay" onclick="WALK_nextStep()" >
		<path id="walkthrough_frame" ></path>
		<text id="walkthrough_text" ></text>
		<text id="walkthrough_skip_button" onclick="WALK_disable();">Skip Tutorial</text>
	</svg>

<!-- From here go nuts, do whatever works for you. Use the container to keep stuff from spilling under topbar. I'll point out patterns to pay attention to. -->
<div style="float: left;" class="container">

<div style='display:table-row'>
	<div class="odd" style='display:table-cell'>
		<table id="user_inputs">
			<tr>
				<td class="collabel">
					Nominal
				</td><td class="collabel">
					Intent
				</td><td>
					Basis
				</td><td class="collabel">
					Hole/Shaft Class
				</td><td class="collabel">
					Hole
				</td><td class="collabel">
					Shaft
				</td><td class="collabel">
					Interference
				</td>
			</tr><tr>
				<td><input id="nominal_0" /></td>
				<td>
					<select id="intent_0" class="doublewide" onchange="selectIntent(); compute();" >
					</select>
				</td><td>
					<select id="basis_0" class="" onchange="selectBasis(); compute();">
						<option value="" selected></option>
						<option value="hole">Hole</option>
						<option value="shaft">Shaft</option>
					</select>
				</td><td>
					<select id="class_hole_0" class="" >
					</select>
				</td><td>
					<select id="class_shaft_0" class="" >
					</select>
				</td>
			</tr>
		</table>
	</div>
</div>
</div>
</body>
</html>